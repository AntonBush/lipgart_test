# Инжиниринговый центр им. А. А. Липгарта Группа ГАЗ

## Тестовое задание «Управление климатом»

В конце файла описано решение задания. Рекомендуется использовать инструмент
Preview, встроенный в Visual Studio или иные.

### Предметная область

Имеет место быть автомобильная климатическая система,
в состав которой входят следующие компоненты:
* вентилятор
салонного конвектора (управление посредствам ШИМ-сигнала);
* электрический отопитель салона (4 режима работы: 0%, 33%, 66%, 100%);
* кондиционер:
  * компрессор кондиционера (4 режима работы: 0%, 33%, 66%, 100%);
  * конденсор кондиционера (3 режима работы: 0%, 50%, 100%).
* датчик температуры внутри салона.

Климатическая система может находиться в 3 возможных состояниях:
* вентиляция (когда температура уставки равняется температуре в салоне);
* охлаждения (когда температура уставки меньше температуры в салоне);
* отопления (когда температура уставки больше температуры салоне).

Мощности каждого из режимов определяются через степень разности
температуры уставки и температуры в салоне (чем больше по модулю,
тем выше мощность работы):
* Отопление реализуется через совместное включение вентиляторов и отопителей.
* Охлаждение – через совместное включение вентилятора, компрессора и конденсора.
* Режим работы конденсора связан с режимом работы компрессора.
* Скорость работы вентилятора связана с текущей мощностью соответствующего режима.

### Входные данные

* Значение температуры уставки;
* Значение температуры в салоне.

### Выходные данные
* Значение температуры уставки;
* Значение температуры в салоне;
* Значение ШИМ вентилятора;
* Режим работы отопителя;
* Режим работы компрессора;
* Режим работы конденсора.

### Формат файла входа
Первое число – температура уставки, второе – температура в салоне

```
20 20
18 20
20 31
…
```

### Формат файла выхода

```
=== Итерация N ===
T уставки = value
T салона = value
Вентилятор = value
Отопитель = value
Компрессора = value
Конденсор = value
```

### Задание

* Написать программу на языке C (структурное программирвоание),
которая эмулировала бы поведение данной системы.
* Декомпозировав систему на несколько сущностей (структур).
* Разработать и реализовать конечный автомат поведение каждой
выделенной сущности, в частности, и системы в целом.
* В качестве входа использовать текстовый файл.
* Входными параметрами покрыть сценарии:
  * включения режимов охлаждения и отопления из режима вентилирования;
  * перевода климатической системы из отопления в охлаждение и наоборот;
  * покрыть все мощности работы.
* Самостоятельно выделить диапазоны разности температуры уставки и температуры в салоне для каждого режима.
* Весь код должен быть прокомментирован.
* Данные для эмуляции читаются из входного файла.
* Результаты пишутся в выходной файл.

### Решение

#### Таблица переходов климатической системы

| Текущий режим         | Охлаждение | Вентиляция | Отопление  |
| :-------------------: |
| Отклонение от уставки (уставка минус текущая температура) |
| -2° и меньше          | Охлаждение | Охлаждение | Охлаждение |
| -1°                   | Охлаждение | Вентиляция | Вентиляция |
|  0°                   | Вентиляция | Вентиляция | Вентиляция |
|  1°                   | Вентиляция | Вентиляция | Отопление  |
|  2° и больше          | Отопление  | Отопление  | Отопление  |

Имеет место несоответствие заданию, в котором сказано, что режим
вентиляции включён тогда, "когда температура уставки равняется
температуре в салоне". Стоит учесть, что согласно заданию датчик
температуры в салоне передаёт информацию в виде целого числа, поэтому
можно предположить, что ошибка датчика равна единице. Климатическая
система будет неустойчивой, если установить режим вентиляции при отклонении
от уставки, равном нулю градусов. Необходимо сделать буферную зону,
чтобы климатическая система была устойчивой.

Предложенная таблица переходов климатической системы
учитывает ранее описанную проблему.

#### Выбор сетки температуры для таблиц переходов устройств, составляющих климатическую систему

Согласно [данному источнику](http://profil.adu.by/mod/book/tool/print/index.php?id=1026):

"Среди множества абиотических факторов, влияющих на человека, значительную роль играет температура. На человека оказывает воздействие не только фактическая температура воздуха, но и ее среднесуточная изменчивость. Так, изменение среднесуточной температуры воздуха на 1—2 ºС считается слабым, на 3—4 ºС — умеренным, более чем на 4 ºС — резким."

На основании данных выше была выбрана сетка температуры:

{-4°, -3°, -2°, -1°, 0°, 1°, 2°, 3°, 4°}

#### Представление режима работы конвектора

Было решено использовать множество значений {0%, 33%, 66%, 100%}
для обозначения режима работы конвектора: долей активного
сигнала относительно всего такта в сигнале ШИМ.

Ниже приведены графики, поясняющие то, что именно
взято за обозначение режима работы конвектора.

```
    PWM signal if Pwm = 30%:

    /|\
     |
     |  |<PWM>|
     |  |     |
    1|  +-----+             +-----+
     |  |     |             |     |
    0|--+     +-------------+     +-------------
     |  |                   |
     |  |<------100%------->|
     |
       ----------------------------------------------> time

    PWM signal if Pwm = 70%:

    /|\
     |
     |  |<----PWM---->|
     |  |             |
    1|  +-------------+     +-------------+
     |  |             |     |             |
    0|--+             +-----+             +-----
     |  |                   |
     |  |<------100%------->|
     |
       ----------------------------------------------> time
```


#### Таблица переходов конвектора

| Текущий режим        | 0% | 33% | 66% | 100% |
| :------------------: |
| Модуль отклонения от уставки |
| 0°                   |   0% |   0% |   0% |   0% |
| 1°                   |   0% |  33% |  33% |  33% |
| 2°                   |  33% |  33% |  66% |  66% |
| 3°                   |  66% |  66% |  66% | 100% |
| 4° и больше          | 100% | 100% | 100% | 100% |

При составлении таблицы переходов конвектора использовались
те же рассуждения, что и при составлении таблицы для
климатической системы в целом. В таблице учтены случаи колебаний
отклонений от уставки, что позволяет конвектору работать
стабильно, без постоянных переключений.

#### Таблица переходов отопителя

| Текущий режим         | 0% | 33% | 66% | 100% |
| :-------------------: |
| Отклонение от уставки |
| 0° и меньше           |   0% |   0% |   0% |   0% |
| 1°                    |   0% |  33% |  33% |  33% |
| 2°                    |  33% |  33% |  66% |  66% |
| 3°                    |  66% |  66% |  66% | 100% |
| 4° и больше           | 100% | 100% | 100% | 100% |

#### Таблица переходов конденсора

| Текущий режим         | 0% | 33% | 66% | 100% |
| :-------------------: |
| Отклонение от уставки |
| -4° и меньше          | 100% | 100% | 100% | 100% |
| -3°                   |  66% |  66% |  66% | 100% |
| -2°                   |  33% |  33% |  66% |  66% |
| -1°                   |   0% |  33% |  33% |  33% |
|  0° и больше          |   0% |   0% |   0% |   0% |

#### Таблица переходов компрессора

| Текущий режим    |   0% |  50% | 100% |
| :--------------: |
| Режим конденсора |
| 0%               |   0% |   0% |   0% |
| 33%              |  50% |  50% |  50% |
| 66%              |  50% |  50% |  50% |
| 100%             | 100% | 100% | 100% |

В случае с компрессором можно устанавливать жёсткое
соответствие режиму работы конденсора, потому что
последний уже сам по себе является стабильным элементом.
